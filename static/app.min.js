class IconLibrary{constructor(){this.iconData=null,this.currentPack=null,this.currentView="loading",this.searchQuery="",this.searchFilter="all",this.iconsPageSize=48,this.iconsRendered=0,this.iconsToRender=[],this.init()}byId(t){return document.getElementById(t)}setView(t){this.currentView=t,window.scrollTo(0,0),["packs","icons","results","error","loading"].forEach((e=>{const s=this.byId(e);s&&(e===t?s.style.removeProperty("display"):s.style.display="none")}))}clearInput(){document.querySelectorAll('input[type="text"]').forEach((t=>t.value="")),this.searchQuery=""}numFormatter=new Intl.NumberFormat(navigator.language||"en-US");formatNumber(t){return"number"==typeof t?this.numFormatter.format(t):t}async init(){this.setupEventListeners(),await this.loadIconData()}setupEventListeners(){this.byId("search-input")?.addEventListener("input",(t=>this.handleSearch(t.target.value))),this.byId("icon-search-input")?.addEventListener("input",(t=>this.filterIcons(t.target.value))),this.byId("back-btn")?.addEventListener("click",(()=>this.showMainView())),this.byId("download-pack-btn")?.addEventListener("click",(()=>this.downloadPack())),document.querySelectorAll(".filter-btn").forEach((t=>t.addEventListener("click",(t=>this.setSearchFilter(t.target.dataset.filter))))),document.addEventListener("keydown",(t=>{"Escape"===t.key&&"packs"!==this.currentView&&this.showMainView(),(t.ctrlKey||t.metaKey)&&"k"===t.key&&(t.preventDefault(),this.byId("search-input").focus())})),document.body.addEventListener("click",(t=>{const e=t.target.closest("button[data-action]");if(!e)return;const{action:s,pack:a,filename:i,packpath:n}=e.dataset;({"show-pack":()=>this.showPackView(a),"download-pack":()=>this.downloadPack(a),"download-icon":()=>this.downloadIcon(i,n),"copy-svg":()=>this.copySvgCode(i,n)})[s]?.()})),window.addEventListener("scroll",(t=>this.onIconsScroll(t)))}async loadIconData(){try{const t=await fetch("icons-data.json");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);this.iconData=await t.json(),this.showMainView()}catch(t){this.setView("error")}}showMainView(){this.currentPack=null,this.setView("packs"),this.clearInput(),this.iconData&&(this.byId("pack-count").textContent=`${this.formatNumber(this.iconData.totalPacks)} packs`,this.byId("icon-count").textContent=`${this.formatNumber(this.iconData.totalIcons)} icons`,this.byId("total-size").textContent=this.iconData.formattedTotalSize,this.byId("packs-grid").innerHTML=this.iconData?.packs.length?this.iconData.packs.map((t=>this.packCardHtml(t))).join(""):"<p>No icon packs found.</p>")}showPackView(t){const e=this.iconData.packs.find((e=>e.name===t));e&&(this.currentPack=e,this.setView("icons"),this.clearInput(),this.byId("pack-name").textContent=e.name,this.byId("pack-icon-count").textContent=`${this.formatNumber(e.iconCount)} icons`,this.byId("pack-size").textContent=e.formattedSize,this.renderIcons(e.icons))}renderIcons(t){if(!t||!t.length)return this.byId("icons-grid").innerHTML="<p>No icons found.</p>",this.iconsToRender=[],void(this.iconsRendered=0);this.byId("icons-grid").innerHTML="",this.iconsToRender=t,this.iconsRendered=0,this.renderNextIcons()}renderNextIcons(){if(!this.iconsToRender||this.iconsRendered>=this.iconsToRender.length)return;const t="results"===this.currentView,e=t?"search-icons-grid":"icons-grid",s=this.iconsToRender.slice(this.iconsRendered,this.iconsRendered+this.iconsPageSize);this.iconsRendered+=s.length,this.byId(e).insertAdjacentHTML("beforeend",s.map((e=>this.iconCardHtml(e,e.packPath,t?e.packName:null))).join(""))}onIconsScroll(){window.innerHeight+window.scrollY>=document.body.offsetHeight-150&&this.renderNextIcons()}filterIcons(t){if(!this.currentPack)return;const e=t.toLowerCase(),s=this.currentPack.icons.filter((t=>t.id.toString().includes(e)||t.description.toLowerCase().includes(e)||t.filename.toLowerCase().includes(e)));this.renderIcons(s)}handleSearch(t){this.searchQuery=t.toLowerCase().trim(),this.searchQuery?this.showSearchResults():this.showMainView()}showSearchResults(){this.setView("results");const t={packs:[],icons:[]};if(!this.iconData)return void this.renderSearchResults(t);const{searchFilter:e,searchQuery:s}=this;"all"!==e&&"pack"!==e||(t.packs=this.iconData.packs.filter((t=>t.name.toLowerCase().includes(s)))),"all"!==e&&"icon"!==e||this.iconData.packs.forEach((e=>{e.icons.filter((t=>t.id.toString().includes(s)||t.description.toLowerCase().includes(s)||t.filename.toLowerCase().includes(s))).forEach((s=>t.icons.push({...s,packName:e.name,packPath:e.path})))})),this.renderSearchResults(t)}renderSearchResults(t){const e=(t.packs?.length||0)+(t.icons?.length||0);this.byId("search-results-count").textContent=`${this.formatNumber(e)} result${1!==e?"s":""}`;const s=[];t.packs?.length&&s.push(`<div class="search-result-section"><div class="search-result-header"><h3>Packs (${this.formatNumber(t.packs.length)})</h3></div><div class="search-result-content"><div class="packs-grid">${t.packs.map((t=>this.packCardHtml(t))).join("")}</div></div></div>`),t.icons?.length&&(s.push(`<div class="search-result-section"><div class="search-result-header"><h3>Icons (${this.formatNumber(t.icons.length)})</h3></div><div class="search-result-content"><div id="search-icons-grid" class="icons-grid"></div></div></div>`),this.iconsToRender=t.icons,this.iconsRendered=0),this.byId("search-results").innerHTML=s.length?s.join(""):"<p>No results found.</p>",this.renderNextIcons()}setSearchFilter(t){this.searchFilter=t,document.querySelectorAll(".filter-btn").forEach((e=>e.classList.toggle("active",e.dataset.filter===t))),this.searchQuery&&this.showSearchResults()}async downloadIcon(t,e=null){const s=e||this.currentPack.path;try{const e=await fetch(`icons/${s}/${t}`);if(!e.ok)throw new Error("Failed to fetch icon");this.downloadBlob(await e.blob(),t)}catch(t){this.showToast("Failed to download icon. Please try again.","error")}}async downloadPack(t=null){const e=t?this.iconData.packs.find((e=>e.name===t)):this.currentPack;if(e)try{const t=new JSZip;for(const s of e.icons){const a=await fetch(`icons/${e.path}/${s.filename}`);a.ok&&t.file(s.filename,await a.text())}const s=await t.generateAsync({type:"blob"});this.downloadBlob(s,`${e.name.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_icons.zip`)}catch(t){this.showToast("Failed to download pack. Please try again.","error")}}downloadBlob(t,e){const s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=e,a.click(),URL.revokeObjectURL(s)}async copySvgCode(t,e=null){const s=e||this.currentPack.path;try{const e=await fetch(`icons/${s}/${t}`);if(!e.ok)throw new Error("Failed to fetch icon");await navigator.clipboard.writeText(await e.text()),this.showToast("SVG code copied to clipboard!")}catch(t){this.showToast("Failed to copy SVG code. Please try again.","error")}}showToast(t,e="success"){const s=document.createElement("div");s.className=`toast ${e}`,s.textContent=t,document.body.appendChild(s),requestAnimationFrame((()=>s.style.transform="translateY( 0 )")),setTimeout((()=>{s.style.transform="translateY( 100px )",setTimeout((()=>s.remove()),200)}),3e3)}packCardHtml(t){return`<div class="pack-card"><div class="pack-header"><h3 class="pack-title">${t.name}</h3><div class="pack-meta"><span>${this.formatNumber(t.iconCount)} icons</span><span>â€¢</span><span>${t.formattedSize}</span></div></div><div class="pack-actions"><button data-action="show-pack" data-pack="${t.name}">View Icons</button><button data-action="download-pack" data-pack="${t.name}">Download Pack</button></div></div>`}iconCardHtml(t,e,s){const a=e||this.currentPack?.path||"";return`<div class="icon-card"><div class="icon-preview"><img src="icons/${a}/${t.filename}" alt="${t.description}" loading="lazy" /></div><div class="icon-name">${t.description}</div><div class="icon-actions"><button data-action="download-icon" data-filename="${t.filename}" data-packpath="${a}">Download</button><button data-action="copy-svg" data-filename="${t.filename}" data-packpath="${a}">Copy SVG</button>`+(s?`<button class="pack-name" data-action="show-pack" data-pack="${s}">${s}</button>`:"")+"</div></div>"}}document.addEventListener("DOMContentLoaded",(()=>{window.app=new IconLibrary}));